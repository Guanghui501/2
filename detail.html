<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Detailed Data</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .detail {
            margin-bottom: 10px;
        }
        #viewer {
            width: 100%;
            height: 400px;
            border: 1px solid #ccc;
            margin-top: 20px;
        }
    </style>
    <!-- 引入 3Dmol.js -->
    <script src="https://3Dmol.org/build/3Dmol-min.js"></script>
</head>
<body>
    <h1>Details</h1>

    <div id="details-container"></div>

    <h2>Atomic Structure Viewer</h2>
    <div id="viewer"></div>

    <script>
        // 获取 URL 参数
        function getUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const params = {};
            urlParams.forEach((value, key) => {
                try {
                    params[key] = JSON.parse(value);  // 尝试解析 JSON 数据
                } catch {
                    params[key] = value;
                }
            });
            return params;
        }

        const params = getUrlParams();
        const detailsContainer = document.getElementById('details-container');

        // 渲染文字信息
        detailsContainer.innerHTML = `
            <div class="detail"><strong>ID:</strong> ${params.id}</div>
            <div class="detail"><strong>Formula:</strong> ${params.formula}</div>
            <div class="detail"><strong>Energy (eV):</strong> ${params.energy}</div>
            <div class="detail"><strong>Mass Density (g/cm³):</strong> ${params.mass_density}</div>
            <div class="detail"><strong>N Concentration (%):</strong> ${params.N_concentration}</div>
            <div class="detail"><strong>E_d (kJ/g):</strong> ${params.E_d}</div>
            <div class="detail"><strong>V_d (km/s):</strong> ${params.V_d}</div>
            <div class="detail"><strong>P_d (GPa):</strong> ${params.P_d}</div>
        `;

        // 生成并渲染分子结构
        function renderMolecule() {
            const viewer = $3Dmol.createViewer("viewer", { backgroundColor: "white" });

            const positions = params.positions;
            const symbols = params.symbols;

            if (!Array.isArray(positions) || !Array.isArray(symbols) || symbols.length !== positions.length) {
                viewer.addLabel("⚠️ 结构数据无法解析", {
                    position: { x: 0, y: 0, z: 0 },
                    backgroundColor: "red"
                });
                viewer.render();
                return;
            }

            // 生成 XYZ 格式字符串
            const xyzData = symbols.map((sym, i) => {
                const [x, y, z] = positions[i];
                return `${sym} ${x} ${y} ${z}`;
            }).join("\n");

            viewer.addModel(xyzData, "xyz");
            viewer.setStyle({}, { stick: {}, sphere: { scale: 0.3 } });
            viewer.zoomTo();
            viewer.render();
        }

        renderMolecule();
    </script>
</body>
</html>
